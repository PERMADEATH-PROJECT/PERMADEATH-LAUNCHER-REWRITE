<div class="dashboard-account-wrapper">
    <h1 class="account-title">
        <lucide-icon [img]="LogIn"></lucide-icon>
        Account Management
    </h1>
    <div class="account-grid">
        <section class="account-section account-section--left">
            <div class="account-section__header">
                <lucide-icon [img]="User"></lucide-icon> Cuenta
            </div>

            <ng-container *ngIf="(user$ | async) === null; else loggedInTpl">
                <div id="login-view">
                    <div class="account-warning">
                        <lucide-icon [img]="TriangleAlert"></lucide-icon>
                        Only one account per player is allowed.
                    </div>
                    <form class="account-form" (ngSubmit)="onLogin()">
                        <label class="account-label">
                            Minecraft Username
                            <input type="text" class="account-input" placeholder="YourUsername" [(ngModel)]="loginUsername" name="lUser" required />
                        </label>
                        <label class="account-label">
                            Password
                            <input type="password" class="account-input" placeholder="********" [(ngModel)]="loginPassword" name="lPass" required />
                        </label>
                        <button class="account-btn account-btn--blue" type="submit">
                            <lucide-icon [img]="LogIn"></lucide-icon> Log In
                        </button>
                        <a class="account-link" (click)="openModal()">Create Account</a>
                    </form>
                </div>
            </ng-container>

            <ng-template #loggedInTpl>
                <div class="profile-card" *ngIf="user$ | async as user">
                    <div class="profile-card__avatar">
                        <lucide-icon [img]="UserRound"></lucide-icon>
                    </div>
                    <div class="profile-card__content">
                        <span class="profile-card__welcome">Welcome back!</span>
                        <h2 class="profile-card__username">{{ user.username }}</h2>
                        <div class="profile-card__badge">
                            <span class="status-dot"></span> Active & Secure Session
                        </div>
                    </div>
                    <div class="profile-card__actions">
                        <button class="account-btn account-btn--red account-btn--outline" (click)="onLogout()">
                            <lucide-icon [img]="LogOut"></lucide-icon> Log Out
                        </button>
                        <p class="profile-card__disclaimer">Death is permanent. Play carefully.</p>
                    </div>
                </div>
            </ng-template>
        </section>

        <section class="account-section" *ngIf="user$ | async as user; else noUserStatus">
            <div class="account-section__header account-section__header--green">
                <lucide-icon [img]="ShieldCheck"></lucide-icon> Estado de la Cuenta
            </div>
            <div class="account-status">
                <div class="account-avatar"><lucide-icon [img]="User"></lucide-icon></div>
                <div class="account-status-info">
                    <span class="account-status-title">Logged in as {{ user.username }}</span>
                    <span class="account-status-desc">Statistics synced</span>
                </div>
                <span class="account-status-state" style="color: #4ade80;">Connected</span>
            </div>
            <div class="account-status-list">
                <div class="account-status-item"><span>Player Status</span><span>{{ user.status ? 'Alive' : 'Dead' }}</span></div>
                <div class="account-status-item"><span>Days Survived</span><span>{{ user.survived_days }}</span></div>
                <div class="account-status-item"><span>Last Login</span><span>{{ user.last_login }}</span></div>
                <div class="account-status-item"><span>Server Role</span><span>{{ user.server_role }}</span></div>
            </div>
        </section>

        <ng-template #noUserStatus>
            <section class="account-section">
                <div class="account-section__header account-section__header--green">
                    <lucide-icon [img]="ShieldCheck"></lucide-icon> Account Status
                </div>
                <div class="account-status">
                    <div class="account-avatar"><lucide-icon [img]="User"></lucide-icon></div>
                    <div class="account-status-info">
                        <span class="account-status-title">Not logged in</span>
                        <span class="account-status-desc">Log in to see your statistics</span>
                    </div>
                    <span class="account-status-state">Disconnected</span>
                </div>
                <div class="account-status-list">
                    <div class="account-status-item"><span>Player Status</span><span>--</span></div>
                    <div class="account-status-item"><span>Days Survived</span><span>--</span></div>
                    <div class="account-status-item"><span>Last Login</span><span>Never</span></div>
                    <div class="account-status-item"><span>Server Role</span><span>--</span></div>
                </div>
            </section>
        </ng-template>
    </div>
</div>

<div class="modal-overlay" *ngIf="showRegisterModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Create Account</h2>
            <button class="modal-close-btn" (click)="closeModal()">&times;</button>
        </div>
        <form class="modal-body" (ngSubmit)="onRegister()">
            <label class="account-label">Username <input type="text" class="account-input" [(ngModel)]="regUsername" name="rUser" required /></label>
            <label class="account-label">Password <input type="password" class="account-input" [(ngModel)]="regPassword" name="rPass" required /></label>
            <label class="account-label">Confirm <input type="password" class="account-input" [(ngModel)]="regConfirm" name="rConf" required /></label>
            <label class="account-label">Code <input type="text" class="account-input" [(ngModel)]="regCode" name="rCode" required /></label>
            <div class="modal-footer">
                <button type="button" class="account-btn account-btn--secondary" (click)="closeModal()">Cancel</button>
                <button type="submit" class="account-btn account-btn--blue">Create</button>
            </div>
        </form>
    </div>
</div>